<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rapport SunWave</title>
    <script defer src="/static/easter-egg.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap');
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Montserrat', sans-serif;
            font-size: 14px;
            line-height: 1.6;
            color: #333;
            background-color: #fff;
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }
        
        .page-container {
            max-width: 210mm;
            margin: 0 auto;
            padding: 10px;
            background-color: #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .header {
            padding: 20px 30px;
            background: linear-gradient(135deg, #28a745 0%, #20883a 100%);
            color: white;
            border-radius: 8px;
            margin-bottom: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .header h1 {
            font-size: 28px;
            font-weight: 600;
            margin: 0;
            color: rgb(0, 0, 0);
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
        }
        
        .header .logo {
            height: 50px;
        }
        
        .section {
            margin-bottom: 15px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
            padding: 15px 20px;
            border: 1px solid #f0f0f0;
            page-break-inside: avoid;
        }
        
        .section h2 {
            font-size: 20px;
            color: #28a745;
            margin-bottom: 15px;
            font-weight: 600;
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 8px;
        }
        
        .section h3 {
            font-size: 16px;
            margin-top: 12px;
            margin-bottom: 8px;
            color: #444;
        }
        
        .data-row {
            margin-bottom: 8px;
            display: flex;
            align-items: baseline;
            flex-wrap: wrap;
        }
        
        .data-row .label {
            font-weight: 600;
            color: #555;
            display: inline-block;
            width: 200px;
            margin-right: 10px;
        }
        
        .data-row .value {
            color: #333;
            font-weight: 500;
        }
        
        .results-container {
            margin-top: 15px;
            page-break-inside: avoid;
        }
        
        .result-title {
            background-color: #e6f7e6;
            padding: 8px 12px;
            font-weight: 600;
            border-radius: 6px;
            margin-bottom: 10px;
            color: #28a745;
            font-size: 16px;
        }
        
        .economy-explained {
            background-color: #f0fff0;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin-top: 15px;
            margin-bottom: 15px;
            border-radius: 0 6px 6px 0;
            page-break-inside: avoid;
        }
        
        .economy-explained h3 {
            color: #28a745;
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .economy-explained p {
            margin-bottom: 10px;
            font-size: 14px;
            color: #444;
        }
        
        .economy-explained ul {
            padding-left: 20px;
            margin-bottom: 15px;
        }
        
        .economy-explained li {
            margin-bottom: 8px;
        }
        
        .highlight {
            font-weight: 600;
            color: #28a745;
        }
        
        .page-break {
            page-break-before: always;
        }
        
        .summary-card {
            background: linear-gradient(to right, #e6f7e6, #ffffff);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 5px solid #28a745;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }
        
        .summary-card h3 {
            color: #28a745;
            margin-bottom: 12px;
            font-size: 18px;
            font-weight: 600;
        }
        
        .summary-card .data-row {
            margin-bottom: 12px;
        }
        
        .summary-card .label {
            font-weight: 600;
            color: #444;
            width: 170px;
        }
        
        .summary-card .value {
            font-weight: 700;
            color: #1a5928;
            font-size: 16px;
            background-color: #e6f7e6;
            padding: 3px 8px;
            border-radius: 4px;
            display: inline-block;
        }
        
        .summary-highlight {
            font-size: 20px;
            font-weight: 700;
            color: #28a745;
            margin: 10px 0;
            text-align: center;
            padding: 10px;
            background-color: #f0fff0;
            border-radius: 6px;
            border: 1px dashed #28a745;
        }
        
        .formula-box {
            background-color: #e6f7e6;
            border: 1px solid #c3e6cb;
            border-radius: 6px;
            padding: 12px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
        }
        
        .formula-box .formula-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #28a745;
        }
        
        .formula-box .formula {
            font-weight: 500;
            color: #333;
        }
        
        .formula-box .formula-description {
            font-size: 13px;
            color: #666;
            margin-top: 8px;
            font-style: italic;
        }
        
        .critical-analysis {
            background-color: #fff8f0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 6px 6px 0;
        }
        
        .critical-analysis h3 {
            color: #e65100;
            margin-top: 0;
            margin-bottom: 10px;
        }
        
        .references-section {
            background-color: #f0f8ff;
            border-radius: 8px;
            margin-top: 20px;
            border: 1px solid #b8daff;
        }
        
        .references-container {
            padding: 5px 0;
        }
        
        .references-list {
            padding-left: 15px;
            margin-bottom: 20px;
        }
        
        .references-list li {
            margin-bottom: 10px;
            font-size: 13px;
            line-height: 1.5;
            text-align: justify;
        }
        
        .reference-author {
            font-weight: 600;
            color: #0062cc;
        }
        
        .parameter-table {
            font-size: 12px;
        }
        
        .parameter-table th {
            font-size: 13px;
            background-color: #e6f2ff;
            color: #0062cc;
        }
        
        .parameter-table td:first-child {
            font-weight: 500;
            width: 30%;
        }
        
        .parameter-table td:nth-child(2) {
            font-weight: 600;
            color: #0062cc;
            width: 20%;
        }
        
        .parameter-table td:last-child {
            font-style: italic;
            color: #555;
            width: 50%;
        }
        
        table.data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 13px;
        }
        
        table.data-table th {
            background-color: #e6f7e6;
            padding: 8px;
            text-align: left;
            font-weight: 600;
            color: #28a745;
            border-bottom: 2px solid #c3e6cb;
        }
        
        /* Styles spécifiques pour les tables dans la section références */
        .references-section table.data-table th {
            background-color: #e6f2ff;
            color: #0062cc;
            border-bottom: 2px solid #b8daff;
        }
        
        table.data-table td {
            padding: 8px;
            border-bottom: 1px solid #e9ecef;
        }
        
        table.data-table tr:nth-child(even) {
            background-color: #f9fafc;
        }
        
        .scientific-note {
            font-size: 13px;
            color: #666;
            font-style: italic;
            margin-top: 8px;
            background-color: #f0fff0;
            padding: 8px;
            border-left: 2px solid #a8d8a8;
        }
        
        .footnote {
            font-size: 12px;
            color: #777;
            margin-top: 5px;
            padding-left: 15px;
            position: relative;
        }
        
        .footnote:before {
            content: "*";
            position: absolute;
            left: 5px;
        }
        
        .footer {
            margin-top: 30px;
            padding-top: 15px;
            border-top: 1px solid #e9ecef;
            text-align: center;
            color: #6c757d;
            font-size: 12px;
        }
        
        @media print {
            body {
                padding: 0;
                margin: 0;
            }
            
            .page-container {
                width: 100%;
                max-width: none;
                margin: 0;
                padding: 10mm;
                box-shadow: none;
            }
            
            .header, .section {
                break-inside: avoid;
            }
            
            .page-break {
                page-break-before: always;
            }
        }
        
        .references-section h2 {
            color: #0062cc;
            border-bottom: 1px solid #b8daff;
        }
        
        .references-section h3 {
            color: #0062cc;
        }
        
        .references-section .formula-box {
            background-color: #e6f2ff;
            border: 1px solid #b8daff;
        }
        
        .references-section .formula-box .formula-title {
            color: #0062cc;
        }
        
        .references-section .scientific-note {
            background-color: #f0f8ff;
            border-left: 2px solid #b8daff;
        }
    </style>
</head>
<body>
    <div class="page-container">
        <div class="header">
            <h1>Rapport SunWave - Analyse Technique</h1>
        </div>
        
        <div class="summary-card">
            <h3>Résumé des résultats</h3>
            <div class="data-row">
                <span class="label">Gain de production:</span>
                <span class="value">+{{ resultats.gain_performance.percentage|round(1)|default('N/A') }}%</span>
            </div>
            <div class="data-row">
                <span class="label">Production annuelle:</span>
                <span class="value">{{ resultats.gain_performance.kwh|round(0)|default('N/A') }} kWh supplémentaires</span>
            </div>
            <div class="data-row">
                <span class="label">Réduction CO₂:</span>
                <span class="value">{{ resultats.impact_environmental.tonnes_co2|round(2)|default('N/A') }} tonnes par an</span>
            </div>
            <p class="summary-highlight">Votre système solaire est optimisé à {{ (resultats.gain_performance.percentage|round(1) + 100)|default('N/A') }}% de sa capacité maximale</p>
        </div>
        
        <div class="section">
            <h2>Configuration de l'installation</h2>
            <div class="data-row">
                <span class="label">Surface totale:</span>
                <span class="value">{{ config.surface|default('Non spécifiée') }} m²</span>
            </div>
            <div class="data-row">
                <span class="label">Nombre de panneaux:</span>
                <span class="value">{{ config.nb_panneaux|default('0') }}</span>
            </div>
            <div class="data-row">
                <span class="label">Puissance installée:</span>
                <span class="value">{{ config.puissance|default('0') }} kWc</span>
            </div>
            <div class="data-row">
                <span class="label">Température moyenne:</span>
                <span class="value">{{ config.temperature|default('Non spécifiée') }}°C</span>
            </div>
            <div class="data-row">
                <span class="label">Fréquence nettoyage:</span>
                <span class="value">Tous les {{ config.jours|default('0') }} jours</span>
            </div>
            
            <div class="scientific-note">
                Note: La puissance nominale (kWc) des panneaux est mesurée dans des conditions standard de test (STC) à 25°C.
                Chaque 1°C d'augmentation au-dessus de cette température réduit l'efficacité d'environ 0.4-0.5%.
            </div>
        </div>
        
        <div class="section">
            <h2>Méthodologie et calculs scientifiques</h2>
            
            <div class="formula-box">
                <div class="formula-title">Calcul du gain de production lié à la température</div>
                <div class="formula">ΔP = P_stc × γ × ΔT</div>
                <div class="formula-description">
                    Où:<br>
                    ΔP = Gain de puissance<br>
                    P_stc = Puissance nominale en conditions standard<br>
                    γ = Coefficient de température de puissance (typiquement -0.4%/°C)<br>
                    ΔT = Différence de température (T_avant - T_après)
                </div>
            </div>
            
            <div class="formula-box">
                <div class="formula-title">Calcul de la réduction annuelle de CO₂</div>
                <div class="formula">CO₂_réduit = ΔE × FE_élec</div>
                <div class="formula-description">
                    Où:<br>
                    ΔE = Gain d'énergie annuel en kWh<br>
                    FE_élec = Facteur d'émission du mix électrique (environ 0.057 kgCO₂/kWh en France)
                </div>
            </div>
            
            <table class="data-table">
                <tr>
                    <th>Paramètre</th>
                    <th>Valeur standard</th>
                    <th>Votre installation</th>
                </tr>
                <tr>
                    <td>Coefficient de température</td>
                    <td>-0.4%/°C</td>
                    <td>-0.45%/°C</td>
                </tr>
                <tr>
                    <td>Efficacité de nettoyage</td>
                    <td>3-8%</td>
                    <td>{{ resultats.gain_performance.percentage|round(1)|default('N/A') }}%</td>
                </tr>
                <tr>
                    <td>Δ Température</td>
                    <td>5-10°C</td>
                    <td>{{ (resultats.temperatures.avant - resultats.temperatures.apres)|round(1)|default('N/A') }}°C</td>
                </tr>
            </table>
        </div>
        
        <div class="page-break"></div>
        
        <div class="section">
            <h2>Résultats de calcul</h2>
            <div class="results-container">
                <div class="result-title">Performance des panneaux</div>
                <div class="data-row">
                    <span class="label">Température avant nettoyage:</span>
                    <span class="value">{{ resultats.temperatures.avant|round(1)|default('N/A') }}°C</span>
                </div>
                <div class="data-row">
                    <span class="label">Température après nettoyage:</span>
                    <span class="value">{{ resultats.temperatures.apres|round(1)|default('N/A') }}°C</span>
                </div>
                <div class="data-row">
                    <span class="label">Gain de production:</span>
                    <span class="value">+{{ resultats.gain_performance.percentage|round(1)|default('N/A') }}% ({{ resultats.gain_performance.kwh|round(0)|default('N/A') }} kWh/an)</span>
                </div>
                <div class="data-row">
                    <span class="label">Gain sur durée de vie:</span>
                    <span class="value">{{ resultats.gain_performance.kwh_vie|round(0)|default('N/A') }} kWh (25 ans)</span>
                </div>
                
                <div class="footnote">
                    Le calcul du gain de production est basé sur la réduction de température et l'amélioration de l'absorption lumineuse.
                    La formule tient compte du coefficient de température des panneaux (-0.45%/°C) et d'un facteur d'encrassement réduit.
                </div>
            </div>
            
            <div class="results-container">
                <div class="result-title">Consommation d'eau</div>
                <div class="data-row">
                    <span class="label">Consommation annuelle:</span>
                    <span class="value">{{ resultats.consommation_eau.total|round(0)|default('N/A') }} L</span>
                </div>
                <div class="data-row">
                    <span class="label">Eau recyclée:</span>
                    <span class="value">{{ resultats.consommation_eau.eau_recyclee|round(0)|default('N/A') }} L ({{ resultats.consommation_eau.pourcentage_recycle|default('N/A') }}%)</span>
                </div>
                <div class="data-row">
                    <span class="label">Eau perdue:</span>
                    <span class="value">{{ resultats.consommation_eau.eau_perdue|round(0)|default('N/A') }} L</span>
                </div>
                
                <div class="footnote">
                    La consommation d'eau est calculée sur la base de 0,5L/m² par cycle de nettoyage, optimisée par notre système de récupération.
                </div>
            </div>
            
            <div class="results-container">
                <div class="result-title">Impact environnemental</div>
                <div class="data-row">
                    <span class="label">Réduction CO₂ annuelle:</span>
                    <span class="value">{{ resultats.impact_environmental.tonnes_co2|round(2)|default('N/A') }} tonnes</span>
                </div>
                <div class="data-row">
                    <span class="label">Équivalent en arbres:</span>
                    <span class="value">{{ resultats.impact_environmental.arbres_equivalents|round(0)|default('N/A') }} arbres plantés</span>
                </div>
                <div class="data-row">
                    <span class="label">Réduction CO₂ (25 ans):</span>
                    <span class="value">{{ resultats.impact_environmental.co2_vie|round(2)|default('N/A') }} tonnes</span>
                </div>
                
                <div class="footnote">
                    L'équivalent en arbres est calculé sur la base qu'un arbre mature absorbe environ 25 kg de CO₂ par an.
                </div>
            </div>
        </div>
        
        <div class="economy-explained">
            <h3>Analyse scientifique de l'impact du nettoyage</h3>
            <p>Notre système SunWave optimise la production de vos panneaux photovoltaïques selon deux mécanismes fondamentaux:</p>
            <ul>
                <li><span class="highlight">Réduction thermique</span>: Les panneaux propres dissipent mieux la chaleur, réduisant leur température de {{ (resultats.temperatures.avant - resultats.temperatures.apres)|round(1)|default('N/A') }}°C. Selon l'équation de dégradation thermique (P = P₀[1 + γ(T-T₀)]), cette réduction génère un gain direct de {{ (0.45 * (resultats.temperatures.avant - resultats.temperatures.apres))|round(1)|default('N/A') }}% en puissance.</li>
                <li><span class="highlight">Transmission lumineuse optimisée</span>: L'élimination des particules de poussière, pollen et pollution améliore la transmission lumineuse de 2-5% selon les études scientifiques du NREL.</li>
                <li><span class="highlight">Cycle de nettoyage optimisé</span>: Notre algorithme ajuste la fréquence de nettoyage (tous les {{ config.jours|default('0') }} jours) selon l'analyse des conditions météorologiques locales et du taux d'encrassement saisonnier.</li>
            </ul>
            <p>Le bilan hydrique de notre système est optimisé par un système de recirculation qui permet de récupérer {{ resultats.consommation_eau.pourcentage_recycle|default('N/A') }}% de l'eau utilisée lors du nettoyage.</p>
        </div>
        
        <div class="page-break"></div>
        
        <div class="critical-analysis">
            <h3>Analyse critique et considérations techniques</h3>
            <p>Notre étude intègre plusieurs facteurs qui influencent l'exactitude des résultats:</p>
            <ul>
                <li>Les calculs sont basés sur des moyennes annuelles de température et d'irradiation, ce qui peut masquer les variations saisonnières significatives</li>
                <li>Le pourcentage d'amélioration de {{ resultats.gain_performance.percentage|round(1)|default('N/A') }}% représente une estimation conservatrice, car certaines études suggèrent des gains pouvant atteindre 12% dans des conditions spécifiques de fort encrassement</li>
                <li>La durée de vie des panneaux peut être prolongée de 2-3 ans grâce à la réduction des points chauds et du stress thermique, un facteur non quantifié dans ce rapport</li>
                <li>L'analyse ne prend pas en compte l'impact potentiel des variations microclimatiques sur votre installation spécifique</li>
            </ul>
            <p>Notre modèle utilise les coefficients de température spécifiques au type de panneaux de votre installation, ce qui garantit une précision optimale des calculs.</p>
        </div>
        
        <div class="section references-section">
            <h2>Références et méthodes de calcul</h2>
            
            <div class="references-container">
                <h3>Sources scientifiques</h3>
                <ul class="references-list">
                    <li><span class="reference-author">National Renewable Energy Laboratory (NREL)</span> - "Soiling Losses for Solar Photovoltaic Systems in California", 2020. Pertes moyennes dues à l'encrassement: 0.3-0.6% par jour en environnement désertique.</li>
                    <li><span class="reference-author">International Energy Agency (IEA)</span> - "Technology Roadmap: Solar Photovoltaic Energy", 2022. Impact du refroidissement sur les performances des modules PV.</li>
                    <li><span class="reference-author">Solar Energy Research Institute of Singapore (SERIS)</span> - "Enhanced Performance of PV Systems", 2021. Gains mesurés grâce aux systèmes de nettoyage automatisés.</li>
                    <li><span class="reference-author">Fraunhofer Institute for Solar Energy Systems</span> - "Photovoltaics Report", 2023. Données sur la dégradation thermique des cellules PV.</li>
                    <li><span class="reference-author">ADEME & RTE</span> - "Facteurs d'émission de CO₂ pour le mix électrique français", 2023. Valeur utilisée: 0.057 kgCO₂/kWh.</li>
                </ul>
                
                <h3>Détails des paramètres utilisés</h3>
                <table class="data-table parameter-table">
                    <tr>
                        <th style="background-color: #e6f2ff; color: #0062cc; border-bottom: 2px solid #b8daff;">Paramètre</th>
                        <th style="background-color: #e6f2ff; color: #0062cc; border-bottom: 2px solid #b8daff;">Valeur</th>
                        <th style="background-color: #e6f2ff; color: #0062cc; border-bottom: 2px solid #b8daff;">Source/Justification</th>
                    </tr>
                    <tr>
                        <td>Coefficient de température</td>
                        <td style="color: #0062cc;">-0.45%/°C</td>
                        <td>Valeur moyenne pour modules silicium monocristallin (Fraunhofer ISE)</td>
                    </tr>
                    <tr>
                        <td>Perte d'efficacité par encrassement</td>
                        <td style="color: #0062cc;">0.5%/jour</td>
                        <td>Études NREL en environnement désertique</td>
                    </tr>
                    <tr>
                        <td>Réduction de température par nettoyage</td>
                        <td style="color: #0062cc;">{{ (resultats.temperatures.avant - resultats.temperatures.apres)|round(1)|default('N/A') }}°C</td>
                        <td>Mesures expérimentales sur installations équivalentes</td>
                    </tr>
                    <tr>
                        <td>Consommation d'eau</td>
                        <td style="color: #0062cc;">0.5L/m² par cycle</td>
                        <td>Données fabricant et tests sur le terrain</td>
                    </tr>
                    <tr>
                        <td>Taux de recyclage d'eau</td>
                        <td style="color: #0062cc;">{{ resultats.consommation_eau.pourcentage_recycle|default('N/A') }}%</td>
                        <td>Performance mesurée du système SunWave</td>
                    </tr>
                    <tr>
                        <td>Durée de vie des panneaux</td>
                        <td style="color: #0062cc;">25 ans</td>
                        <td>Standard industriel (garantie moyenne des fabricants)</td>
                    </tr>
                    <tr>
                        <td>Absorption CO₂ par arbre</td>
                        <td style="color: #0062cc;">25 kg/an</td>
                        <td>Estimation EPA (Environmental Protection Agency)</td>
                    </tr>
                </table>
                
                <h3>Équations utilisées</h3>
                <div class="formula-box">
                    <div class="formula-title">Calcul complet du gain de performance</div>
                    <div class="formula">ΔP(%) = γ × ΔT + ε × (1 - e<sup>-k×f</sup>)</div>
                    <div class="formula-description">
                        Où:<br>
                        ΔP = Gain de performance en pourcentage<br>
                        γ = Coefficient de température (-0.45%/°C)<br>
                        ΔT = Réduction de température (T_avant - T_après)<br>
                        ε = Gain maximal potentiel par nettoyage (15%)<br>
                        k = Coefficient d'encrassement (0.5%/jour)<br>
                        f = Fréquence de nettoyage (jours)
                    </div>
                </div>
                
                <p class="scientific-note">
                    Note méthodologique: Nos calculs tiennent compte de l'interaction complexe entre le refroidissement des panneaux, la réduction de l'encrassement et l'amélioration de l'absorption lumineuse. Les modèles mathématiques ont été calibrés sur la base de données recueillies sur 27 installations pilotes dans différentes conditions climatiques. 
                </p>
                
                <p class="scientific-note">
                    Les performances calculées restent des estimations et peuvent varier selon les conditions spécifiques de votre installation, notamment l'orientation, l'inclinaison des panneaux, les ombrages éventuels et les variations microclimatiques. Un audit énergétique personnalisé est recommandé pour des projections plus précises.
                </p>
            </div>
        </div>
        
        <div class="footer">
            <p>Ce rapport a été généré automatiquement par SunWave | {{ generation_date|default('Date non spécifiée') }}</p>
            <p>Méthodes de calcul basées sur les standards scientifiques IEC 61215 et IEC 61730 pour les performances photovoltaïques</p>
            <p>Pour toute question, contactez-nous à contact@sun-wave.site ou appelez le 07 83 26 53 18</p>
        </div>
    </div>
</body>
</html> 